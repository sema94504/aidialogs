# Workflow: Устранение технического долга

Работай строго по `docs/tasklist_tech_debt.md`. Выполняй итерации последовательно.

## Цикл каждой итерации

### 1. ПЛАНИРОВАНИЕ
- Прочитай текущую итерацию из `docs/tasklist_tech_debt.md`
- Предложи решение с конкретными отрезками кода
- Проверь соответствие принципам из `docs/vision.md`
- **ОЖИДАЙ согласования перед началом**

### 2. РЕАЛИЗАЦИЯ
- Реализуй согласованное решение
- Следуй правилам из `docs/conventions.md`
- Выполни все пункты итерации
- **Применяй инструменты качества:**
  - `make format` - перед коммитом
  - `make lint` - проверка стиля
  - `make typecheck` - проверка типов (если mypy уже добавлен)

### 3. ТЕСТИРОВАНИЕ
- Выполни тесты из раздела "Тест" итерации
- Запусти `make test` - все тесты должны проходить
- Запусти `make coverage` - проверь покрытие кода
- Убедись что всё работает
- **ОЖИДАЙ подтверждения**

### 4. ПРОВЕРКА КАЧЕСТВА
- Запусти `make lint` - исправь все ошибки линтера
- Запусти `make format` - отформатируй код
- Запусти `make typecheck` - проверь типы (если доступно)
- Проверь соответствие принципам из `docs/vision.md`:
  - KISS - код остался простым?
  - MVP - не добавлено лишнего?
  - 1 класс = 1 файл?
  - Линейный код, прямые зависимости?

### 5. ФИКСАЦИЯ
- Отметь выполненные задачи (✅) в `docs/tasklist_tech_debt.md`
- Обнови таблицу прогресса (статус ✅, дата)
- Сделай коммит

### 6. ПЕРЕХОД
- **СОГЛАСУЙ** переход к следующей итерации
- Повторяй цикл

## Правила коммитов

Формат:
- Глагол в третьем лице: добавлено, исправлено, реализовано
- Максимум 80 символов
- Отвечает на вопрос "Что изменится после коммита?"
- Без точки в конце

Примеры:
- "Добавлено Ruff для линтинга и форматирования кода"
- "Реализован SessionManager для управления сессиями"
- "Добавлено pytest-cov и настроено покрытие тестами"

## ОБЯЗАТЕЛЬНО

- ❌ НЕ начинай реализацию без согласования
- ❌ НЕ переходи к следующей итерации без подтверждения
- ❌ НЕ коммить код с ошибками линтера
- ❌ НЕ коммить код с падающими тестами
- ✅ Обновляй `docs/tasklist_tech_debt.md` после каждой итерации
- ✅ Делай коммит после каждой итерации
- ✅ Запускай `make format` и `make lint` перед коммитом
- ✅ Запускай `make test` перед коммитом

## Структура сообщений

### При планировании:
```
Итерация N: [название]

Предлагаю следующее решение:
[описание]

Изменения:
- [файл 1]: [что меняется]
- [файл 2]: [что меняется]

Код:
[ключевые отрезки кода]

Проверка vision.md:
- [принцип 1]: [соответствует/не соответствует]
- [принцип 2]: [соответствует/не соответствует]

Готов начать после согласования.
```

### После реализации:
```
Итерация N: завершена

Реализовано:
- [список выполненных задач]

Тесты: [результат make test]
Линтер: [результат make lint]
Форматирование: [результат make format]
Coverage: [% покрытия]

Проверка vision.md:
✓ [принцип 1]
✓ [принцип 2]

Обновил tasklist_tech_debt.md, готов делать коммит.
```

## Приоритеты качества

При реализации учитывай приоритеты:

**High Priority:**
1. Все тесты проходят
2. Нет ошибок линтера
3. Код отформатирован
4. Покрытие тестами не падает

**Medium Priority:**
5. Type hints добавлены (где применимо)
6. Нет предупреждений mypy (если доступен)

**Low Priority:**
7. Улучшение читаемости
8. Оптимизация производительности

## Инструменты качества

После добавления инструментов используй:

```bash
make format     # Форматирование кода (Ruff)
make lint       # Проверка стиля (Ruff)
make typecheck  # Проверка типов (Mypy)
make test       # Запуск тестов
make coverage   # Покрытие тестами
```

Порядок выполнения перед коммитом:
1. `make format` - отформатировать
2. `make lint` - проверить и исправить ошибки
3. `make typecheck` - проверить типы (если доступно)
4. `make test` - убедиться что тесты проходят
5. `make coverage` - проверить покрытие

## Особенности технического долга

При устранении технического долга:

1. **Сохраняй простоту** - не усложняй архитектуру
2. **Проверяй обратную совместимость** - бот должен работать как прежде
3. **Тестируй изменения** - добавляй тесты для новой логики
4. **Документируй решения** - обновляй vision.md при изменении архитектуры
5. **Не переусложняй** - следуй KISS, даже при рефакторинге

