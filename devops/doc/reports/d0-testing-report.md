# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: –°–ø—Ä–∏–Ω—Ç D0 - Basic Docker Setup

**–î–∞—Ç–∞:** 2025-10-18  
**–í–µ—Ä—Å–∏—è:** 3.0 (Final)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û - –í–°–ï –°–ï–†–í–ò–°–´ –†–ê–ë–û–¢–ê–Æ–¢

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#—Ü–µ–ª—å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
2. [–û–∫—Ä—É–∂–µ–Ω–∏–µ](#–æ–∫—Ä—É–∂–µ–Ω–∏–µ)
3. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-–ø—Ä–æ–≤–µ—Ä–∫–∏)
4. [–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#–Ω–∞–π–¥–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
5. [–†–µ—à–µ–Ω–∏—è](#—Ä–µ—à–µ–Ω–∏—è)
6. [–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞](#–∫–æ–º–∞–Ω–¥—ã-–¥–ª—è-–∑–∞–ø—É—Å–∫–∞)
7. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
8. [–ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å](#–∏—Ç–æ–≥–æ–≤—ã–π-—Å—Ç–∞—Ç—É—Å)

---

## –¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å Docker setup –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö 3 —Å–µ—Ä–≤–∏—Å–æ–≤ (Bot, API, Frontend) —á–µ—Ä–µ–∑ `docker-compose up`.

## –û–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
OS: Linux 6.6.87.2-microsoft-standard-WSL2
Docker: Docker version 28.5.0, build 887030f
Docker Compose: Docker Compose version v2.40.0
–ü—É—Ç—å: /root/work/aidialogs
```

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Docker

```bash
$ which docker
/usr/bin/docker

$ docker --version
Docker version 28.5.0, build 887030f
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### ‚úÖ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker Compose

```bash
$ docker compose version
Docker Compose version v2.40.0
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Docker Compose v2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### ‚úÖ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤

```bash
$ ls -1 Dockerfile.* docker-compose.yml .env.docker .dockerignore
.dockerignore
.env.docker
Dockerfile.api
Dockerfile.bot
Dockerfile.frontend
docker-compose.yml
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

### ‚ö†Ô∏è 4. –í–∞–ª–∏–¥–∞—Ü–∏—è docker-compose.yml (v1)

```bash
$ docker compose config
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Warning –æ `version: '3.8'` - —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ Docker Compose v2

```
compose.yml: the attribute `version` is obsolete, 
it will be ignored, please remove it to avoid potential confusion
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è Warning (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

---

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä `version` –≤ docker-compose.yml

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
Docker Compose v2 –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏—è `version: '3.8'` –∏ –≤—ã–¥–∞–µ—Ç warning.

**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (warning, –Ω–µ –æ—à–∏–±–∫–∞)

**–§–∞–π–ª:** `docker-compose.yml`

**–°—Ç—Ä–æ–∫–∞:** 1

**–î–æ:**
```yaml
version: '3.8'

services:
  bot:
    ...
```

**–ü–æ—Å–ª–µ:**
```yaml
services:
  bot:
    ...
```

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `version: '3.8'`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ .env.docker

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–§–∞–π–ª `.env.docker` –Ω–µ —Å–æ–∑–¥–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç–æ–ª—å–∫–æ —à–∞–±–ª–æ–Ω `env.docker.template`.

**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫)

**–†–µ—à–µ–Ω–∏–µ:**  
```bash
cp env.docker.template .env.docker
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (—Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

## –†–µ—à–µ–Ω–∏—è

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –£–¥–∞–ª–µ–Ω–∏–µ version –∏–∑ docker-compose.yml

**–§–∞–π–ª:** `docker-compose.yml`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –£–¥–∞–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ `version: '3.8'`

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
```bash
$ docker compose config > /dev/null 2>&1
$ echo $?
0
```

‚úÖ docker-compose.yml –≤–∞–ª–∏–¥–µ–Ω

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –°–æ–∑–¥–∞–Ω–∏–µ .env.docker

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
cp env.docker.template .env.docker
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ .env.docker:**
```env
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=your_bot_token_here

# LLM Configuration
LLM_BASE_URL=http://host.docker.internal:3000/v1
LLM_MODEL=gpt-oss:latest

# System Configuration
SYSTEM_PROMPT_FILE=prompts/system_prompt.txt
DATABASE_PATH=/app/data/aidialogs.db

# API Configuration
USE_MOCK_STATS=true
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π `TELEGRAM_BOT_TOKEN`

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```bash
cp env.docker.template .env.docker
```

2. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env.docker:**
```bash
nano .env.docker  # –∏–ª–∏ vim, –∏–ª–∏ –ª—é–±–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
# –£–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π TELEGRAM_BOT_TOKEN
```

3. **–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):**
```bash
mkdir -p ./data
```

### –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ (–∑–∞–π–º–µ—Ç 5-10 –º–∏–Ω—É—Ç)
make docker-build

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Ñ–æ–Ω–µ
make docker-up

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make docker-status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make docker-logs

# –ò–ª–∏ –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
make docker-logs-bot
make docker-logs-api
make docker-logs-frontend
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
# Health check API
curl http://localhost:8000/health
# –û–∂–∏–¥–∞–µ–º: {"status": "ok"}

# Frontend (–≤ –±—Ä–∞—É–∑–µ—Ä–µ)
http://localhost:3000

# API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–≤ –±—Ä–∞—É–∑–µ—Ä–µ)
http://localhost:8000/docs
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
make docker-down

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ volumes)
make docker-clean
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º

- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker –∏ Docker Compose (‚úÖ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
- [ ] –°–æ–∑–¥–∞—Ç—å `.env.docker` –∏–∑ —à–∞–±–ª–æ–Ω–∞
- [ ] –£–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π `TELEGRAM_BOT_TOKEN`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å LLM —Å–µ—Ä–≤–µ—Ä–∞ (`LLM_BASE_URL`)
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic (–µ—Å–ª–∏ –ë–î –ø—É—Å—Ç–∞—è)

### 2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

- **–ú–∏–Ω–∏–º—É–º:** 4 GB RAM, 10 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** 8 GB RAM, 20 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **–ü–æ—Ä—Ç—ã:** 3000, 8000 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã

### 3. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

#### –ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–Ω—è—Ç—ã–µ –ø–æ—Ä—Ç—ã
netstat -tuln | grep -E ':(3000|8000)'

# –ò–ª–∏ —Å lsof
lsof -i :3000
lsof -i :8000
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ ./data/

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
chmod 755 ./data
```

#### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose logs bot
docker compose logs api
docker compose logs frontend
```

### 4. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å hot-reload

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫:

```bash
# Bot
make run

# API
make run-api

# Frontend
make frontend-dev
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞.

---

## –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### Dockerfile.bot (22 —Å—Ç—Ä–æ–∫–∏)

‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- Base image: `python:3.11-slim`
- UV —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ pip
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/app/data` —Å–æ–∑–¥–∞–µ—Ç—Å—è
- CMD –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞

‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π build (—Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏)
- UV sync –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ --frozen-lockfile

### Dockerfile.api (24 —Å—Ç—Ä–æ–∫–∏)

‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Dockerfile.bot
- EXPOSE 8000
- CMD –∑–∞–ø—É—Å–∫–∞–µ—Ç uvicorn —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π build

### Dockerfile.frontend (23 —Å—Ç—Ä–æ–∫–∏)

‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- Base image: `node:23-slim`
- pnpm —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ
- package.json –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–µ–≤)
- pnpm build –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- CMD –∑–∞–ø—É—Å–∫–∞–µ—Ç `pnpm start`

‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π build
- Next.js –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### docker-compose.yml (54 —Å—Ç—Ä–æ–∫–∏)

‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- 3 —Å–µ—Ä–≤–∏—Å–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã: frontend ‚Üí api ‚Üí bot
- Volumes –¥–ª—è SQLite –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –ü–æ—Ä—Ç—ã –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- env_file —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ .env.docker
- restart: unless-stopped –¥–ª—è –≤—Å–µ—Ö
- –°–µ—Ç—å aidialogs-network —Å–æ–∑–¥–∞–µ—Ç—Å—è

‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
```bash
$ docker compose config
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞ (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è version)
```

---

## Dry-Run –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# 1. –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
$ docker compose config --services
bot
api
frontend
‚úÖ –í—Å–µ 3 —Å–µ—Ä–≤–∏—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã

# 2. –û–±—Ä–∞–∑—ã
$ docker compose config --images
aidialogs-api
aidialogs-frontend
aidialogs-bot
‚úÖ –í—Å–µ –æ–±—Ä–∞–∑—ã –∏–º–µ–Ω–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
$ docker compose config | grep -A2 'ports:'
- target: 8000 (API)
- target: 3000 (Frontend)
‚úÖ –ü–æ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
frontend ‚Üí depends_on: api (condition: service_started)
api ‚Üí depends_on: bot (condition: service_started)
‚úÖ –¶–µ–ø–æ—á–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤
$ netstat -tuln | grep -E ':(3000|8000)'
‚úÖ –ü–æ—Ä—Ç—ã 3000 –∏ 8000 —Å–≤–æ–±–æ–¥–Ω—ã

# 6. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö
$ ls -la data/
total 12
drwxr-xr-x  2 root root 4096 Oct 18 10:21 .
-rw-r--r--  1 root root  140 Oct 18 10:22 .gitignore
‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

# 7. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
$ docker compose config > /tmp/compose-validated.yml
$ wc -l /tmp/compose-validated.yml
76 /tmp/compose-validated.yml
‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∞–ª–∏–¥–Ω–∞
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Dockerfile

**Dockerfile.bot (22 —Å—Ç—Ä–æ–∫–∏):**
```dockerfile
FROM python:3.11-slim
WORKDIR /app
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ UV
RUN pip install --no-cache-dir uv
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
COPY pyproject.toml uv.lock ./
COPY src/ ./src/
...
CMD ["uv", "run", "python", "-m", "src.main"]
```
‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

**Dockerfile.api (24 —Å—Ç—Ä–æ–∫–∏):**
```dockerfile
FROM python:3.11-slim
WORKDIR /app
...
EXPOSE 8000
CMD ["uv", "run", "uvicorn", "src.api.main:app", "--host", "0.0.0.0", "--port", "8000"]
```
‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

**Dockerfile.frontend (23 —Å—Ç—Ä–æ–∫–∏):**
```dockerfile
FROM node:23-slim
WORKDIR /app
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pnpm
RUN npm install -g pnpm
...
CMD ["pnpm", "start"]
```
‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

---

## –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ docker-compose.yml –≤–∞–ª–∏–¥–µ–Ω
- ‚úÖ .env.docker —Å–æ–∑–¥–∞–Ω –∏–∑ —à–∞–±–ª–æ–Ω–∞
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å–µ—Ö Dockerfile –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–ª–∞–Ω—É D0

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (dry-run):**
- ‚úÖ –í—Å–µ 3 —Å–µ—Ä–≤–∏—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (bot, api, frontend)
- ‚úÖ –û–±—Ä–∞–∑—ã –∏–º–µ–Ω–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ (aidialogs-bot, aidialogs-api, aidialogs-frontend)
- ‚úÖ –ü–æ—Ä—Ç—ã 3000 –∏ 8000 —Å–≤–æ–±–æ–¥–Ω—ã
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã: frontend ‚Üí api ‚Üí bot
- ‚úÖ Volumes –¥–ª—è SQLite –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è ./data/ –≥–æ—Ç–æ–≤–∞ —Å .gitignore
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å–µ—Ö Dockerfile –≤–∞–ª–∏–¥–µ–Ω
- ‚úÖ docker-compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞ (76 —Å—Ç—Ä–æ–∫)

**–†–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ):**
- ‚úÖ –û–±—Ä–∞–∑—ã —Å–æ–±—Ä–∞–Ω—ã (aidialogs-bot, aidialogs-api, aidialogs-frontend)
- ‚úÖ –í—Å–µ 3 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ API Health check: {"status":"ok"}
- ‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω (HTTP 307)
- ‚úÖ Bot –∑–∞–ø—É—â–µ–Ω, polling –∞–∫—Ç–∏–≤–µ–Ω (@aidialogs_bot)
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ (./data/aidialogs.db)

**–†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**
1. docker-compose ‚Üí docker compose (Docker Compose v2)
2. Network pools –∏—Å—á–µ—Ä–ø–∞–Ω—ã ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω network_mode: bridge

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env.docker:**
   - –£–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π `TELEGRAM_BOT_TOKEN`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å LLM —Å–µ—Ä–≤–µ—Ä–∞

2. **–í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–±–æ—Ä–∫—É:**
   ```bash
   make docker-build
   ```
   –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: 5-10 –º–∏–Ω—É—Ç

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:**
   ```bash
   make docker-up
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**
   ```bash
   make docker-status
   make docker-logs
   ```

5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
   - http://localhost:3000 (Frontend)
   - http://localhost:8000/health (API)
   - http://localhost:8000/docs (API Docs)

---

## –í—ã–≤–æ–¥—ã

### ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É D0
2. docker-compose.yml –≤–∞–ª–∏–¥–µ–Ω
3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
4. MVP –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–±–ª—é–¥–µ–Ω—ã (–ø—Ä–æ—Å—Ç—ã–µ Dockerfile)
5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∞—è (README.md, DOCKER.md)
6. Makefile –∫–æ–º–∞–Ω–¥—ã —É–¥–æ–±–Ω—ã

### ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)

1. ~~–£—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä `version` –≤ docker-compose.yml~~ ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
2. ~~–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ .env.docker~~ ‚Üí ‚úÖ –°–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é (–¥–ª—è –±—É–¥—É—â–∏—Ö —Å–ø—Ä–∏–Ω—Ç–æ–≤)

1. –î–æ–±–∞–≤–∏—Ç—å healthcheck –≤ docker-compose.yml –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
2. –î–æ–±–∞–≤–∏—Ç—å wait-for-it.sh —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Alembic –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
4. –î–æ–±–∞–≤–∏—Ç—å docker-compose.dev.yml –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å hot-reload
5. –î–æ–±–∞–≤–∏—Ç—å .dockerignore –¥–ª—è frontend/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ

---

---

## –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ –°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£

–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–µ–µ dry-run —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Docker setup. –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–∞–ª–∏–¥–Ω—ã, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ docker-compose up –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã
- ‚úÖ –ü–æ—Ä—Ç—ã 3000 –∏ 8000 –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç
- ‚úÖ SQLite –ë–î –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**  
–°–ø—Ä–∏–Ω—Ç D0 –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ø—Ä–∏–Ω—Ç—É **D1: Build & Publish**.

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** AI Assistant  
**–î–∞—Ç–∞:** 2025-10-18  
**–í–µ—Ä—Å–∏—è –æ—Ç—á–µ—Ç–∞:** 2.0 (–§–∏–Ω–∞–ª—å–Ω–∞—è)

