# AI Dialogs Bot

Telegram –±–æ—Ç –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤ —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ API.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ –î–∏–∞–ª–æ–≥–∏ —Å AI —á–µ—Ä–µ–∑ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API
- üíæ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ SQLite
- üîç –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º (FTS5)
- üîÑ –ö–æ–º–∞–Ω–¥–∞ `/reset` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
- üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —Ñ–∞–π–ª
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ 97%
- üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
- üóëÔ∏è Soft delete - –¥–∞–Ω–Ω—ã–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ:**
- Python 3.11+
- aiogram 3.x (Telegram Bot API)
- openai (–∫–ª–∏–µ–Ω—Ç –¥–ª—è LLM API)
- pydantic-settings (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π)
- aiosqlite (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å SQLite)
- alembic (—Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î)
- uv (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏)

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- ruff - –ª–∏–Ω—Ç–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä (–∑–∞–º–µ–Ω—è–µ—Ç black, isort, flake8)
- mypy - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
- pytest - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- pytest-cov - –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏
- pytest-asyncio - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ async —Ç–µ—Å—Ç–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ uv

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd aidialogs
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
uv sync --extra dev
```

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env`:

```env
TELEGRAM_BOT_TOKEN=your_bot_token_here
LLM_BASE_URL=http://your-llm-server:3000/v1
LLM_MODEL=gpt-oss:latest
SYSTEM_PROMPT_FILE=prompts/system_prompt.txt
```

## –ó–∞–ø—É—Å–∫

### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Bot, API, Frontend) –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π —á–µ—Ä–µ–∑ Docker Compose:

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker
- Docker Compose

#### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
cp env.docker.template .env.docker
```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env.docker` –∏ —É–∫–∞–∂–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π `TELEGRAM_BOT_TOKEN`

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:
```bash
make docker-build
make docker-up
```

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

- **Frontend**: http://localhost:3000
- **API**: http://localhost:8000
- **API Docs**: http://localhost:8000/docs

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
make docker-up

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
make docker-down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make docker-logs

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
make docker-logs-bot
make docker-logs-api
make docker-logs-frontend

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
make docker-status

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
make docker-build

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ volumes)
make docker-clean
```

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º)

```bash
make run
```

–∏–ª–∏

```bash
uv run python -m src.main
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞

–ù–∞–∂–º–∏—Ç–µ `Ctrl+C` –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ù–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥, –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
- `/reset` - –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞

### –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: –ü—Ä–∏–≤–µ—Ç! –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ó–∞–¥–∞–π –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ö–∞–∫ –¥–µ–ª–∞?
–ë–æ—Ç: [–æ—Ç–≤–µ—Ç –æ—Ç LLM]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /reset
–ë–æ—Ç: –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –æ—á–∏—â–µ–Ω–∞. –ù–∞—á–Ω—ë–º —Å–Ω–∞—á–∞–ª–∞!
```

## –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞:

- **Ruff** - –±—ã—Å—Ç—Ä—ã–π –ª–∏–Ω—Ç–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä (–∑–∞–º–µ–Ω—è–µ—Ç black, isort, flake8)
- **Mypy** - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
- **pytest-cov** - –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏

### –ö–æ–º–∞–Ω–¥—ã

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
make format

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è
make lint

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
make typecheck

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
make coverage

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
make clean
```

### –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
make format     # 1. –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
make lint       # 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∏–ª—å
make typecheck  # 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã
make test       # 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make coverage   # 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
aidialogs/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ bot.py               # TelegramBot –∫–ª–∞—Å—Å
‚îÇ   ‚îú‚îÄ‚îÄ llm_client.py        # LLMClient –∫–ª–∞—Å—Å
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # Config –∫–ª–∞—Å—Å (pydantic-settings)
‚îÇ   ‚îú‚îÄ‚îÄ database.py          # DatabaseManager –∫–ª–∞—Å—Å
‚îÇ   ‚îî‚îÄ‚îÄ session_manager.py   # SessionManager –∫–ª–∞—Å—Å
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_bot.py              # —Ç–µ—Å—Ç—ã Bot
‚îÇ   ‚îú‚îÄ‚îÄ test_llm_client.py       # —Ç–µ—Å—Ç—ã LLMClient
‚îÇ   ‚îú‚îÄ‚îÄ test_config.py           # —Ç–µ—Å—Ç—ã Config
‚îÇ   ‚îú‚îÄ‚îÄ test_database.py         # —Ç–µ—Å—Ç—ã DatabaseManager
‚îÇ   ‚îú‚îÄ‚îÄ test_session_manager.py  # —Ç–µ—Å—Ç—ã SessionManager
‚îÇ   ‚îî‚îÄ‚îÄ test_integration.py      # –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ alembic/
‚îÇ   ‚îú‚îÄ‚îÄ env.py               # Alembic environment
‚îÇ   ‚îî‚îÄ‚îÄ versions/            # –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ idea.md              # –æ–ø–∏—Å–∞–Ω–∏–µ –∏–¥–µ–∏
‚îÇ   ‚îú‚îÄ‚îÄ vision.md            # —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ archive/             # –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ .cursor/rules/
‚îÇ   ‚îú‚îÄ‚îÄ conventions.mdc      # —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –ø–æ –∫–æ–¥—É
‚îÇ   ‚îî‚îÄ‚îÄ workflow.mdc         # –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ .env                     # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ .env.example             # –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ aidialogs.db             # –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ alembic.ini              # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îú‚îÄ‚îÄ Makefile                 # –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ pyproject.toml           # –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îî‚îÄ‚îÄ pytest.ini               # –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ pytest
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
main.py -> Config -> DatabaseManager -> SessionManager
                  ‚Üì                           ‚Üë
                  Bot -------------------------+
                  ‚Üì
              LLMClient -> OpenAI API
```

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. `TelegramBot` –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ aiogram
3. `SessionManager` –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ë–î —á–µ—Ä–µ–∑ `DatabaseManager`
4. `TelegramBot` –≤—ã–∑—ã–≤–∞–µ—Ç `LLMClient.get_response()` —Å –∏—Å—Ç–æ—Ä–∏–µ–π
5. `SessionManager` —á–∏—Ç–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑ –ë–î —á–µ—Ä–µ–∑ `DatabaseManager`
6. `LLMClient` –¥–æ–±–∞–≤–ª—è–µ—Ç system prompt –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ API
7. –û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —á–µ—Ä–µ–∑ `SessionManager` –∏ `DatabaseManager`
8. `TelegramBot` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **Config** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ pydantic-settings
- **DatabaseManager** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å SQLite –ë–î
- **TelegramBot** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **SessionManager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ –ë–î
- **LLMClient** - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å LLM API

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ test_config.py          # –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_llm_client.py      # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM
‚îú‚îÄ‚îÄ test_bot.py             # –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ test_session_manager.py # —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îî‚îÄ‚îÄ test_integration.py     # –±–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```

### –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ >80%
- –¢–µ—Å—Ç –Ω–∞ –∫–∞–∂–¥—É—é –ø—É–±–ª–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é/–º–µ—Ç–æ–¥
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ error handling –∏ edge cases
- –ú–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Telegram API, LLM API)
- AAA –ø–∞—Ç—Ç–µ—Ä–Ω (Arrange-Act-Assert)

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
make test

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make coverage

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
uv run pytest tests/test_bot.py -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
uv run pytest tests/test_bot.py::test_start_handler -v
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

–¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: **>80%**

HTML –æ—Ç—á–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `htmlcov/index.html` –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `make coverage`.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤:
- –ö–æ–Ω—Å–æ–ª—å (stdout)
- –§–∞–π–ª `bot.log`

–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:
```
2025-10-11 12:00:00 - bot - INFO - –ö–æ–º–∞–Ω–¥–∞ /start –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123456
2025-10-11 12:00:05 - bot - INFO - –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123456: –ü—Ä–∏–≤–µ—Ç
2025-10-11 12:00:05 - bot - INFO - –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ LLM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123456
2025-10-11 12:00:08 - bot - INFO - –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç LLM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123456
```

–õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è:
- –°—Ç–∞—Ä—Ç/—Å—Ç–æ–ø –±–æ—Ç–∞
- –í—Ö–æ–¥—è—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è (user_id, —Ç–µ–∫—Å—Ç)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ LLM
- –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç LLM
- –û—à–∏–±–∫–∏ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

## –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ SQLite —á–µ—Ä–µ–∑ `DatabaseManager`
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î —á–µ—Ä–µ–∑ aiosqlite
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- Soft delete - –¥–∞–Ω–Ω—ã–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è, –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ FTS5 (–≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é)
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î —á–µ—Ä–µ–∑ Alembic

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

- **KISS** (Keep It Simple, Stupid) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞
- **MVP** –ø–æ–¥—Ö–æ–¥ - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- **SOLID** –ø—Ä–∏–Ω—Ü–∏–ø—ã: SRP, DIP
- **DRY** (Don't Repeat Yourself) - –Ω–µ –¥—É–±–ª–∏—Ä—É–π –∫–æ–¥
- **1 –∫–ª–∞—Å—Å = 1 —Ñ–∞–π–ª** - —Å—Ç—Ä–æ–≥–æ
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è –≤–µ–∑–¥–µ** - type hints –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–°–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–¥** - –±–µ–∑ docstrings

### –°—Ç–∏–ª—å –∫–æ–¥–∞

- –î–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏: 100 —Å–∏–º–≤–æ–ª–æ–≤
- Python 3.11+ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å: `list[dict]`, `dict[int, str]`
- PascalCase –¥–ª—è –∫–ª–∞—Å—Å–æ–≤: `TelegramBot`, `SessionManager`
- snake_case –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π: `get_response`, `add_message`
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã: `_start_handler`, `_validate`

### Workflow

1. –ü—Ä–æ—á–∏—Ç–∞–π –∏—Ç–µ—Ä–∞—Ü–∏—é –∏–∑ tasklist
2. –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—à–µ–Ω–∏–µ
3. –ü–æ–ª—É—á–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
4. –†–µ–∞–ª–∏–∑—É–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞
5. –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã
6. –û–±–Ω–æ–≤–∏ tasklist
7. –°–¥–µ–ª–∞–π –∫–æ–º–º–∏—Ç

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: `.cursor/rules/workflow.mdc`

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
